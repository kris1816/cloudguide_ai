<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="CloudGuide Premium - AI-Powered Audioguides" />
    <meta property="og:description" content="Create premium audioguides with Claude AI and Speechify" />
    <title>CloudGuide Premium - Claude AI & Speechify</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,400i,600,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fcfeff;
            min-height: 100vh;
            color: #2d3748;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header matching other pages */
        .header {
            background: white;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-section img {
            height: 40px;
        }

        .premium-badge {
            background: #48bb78;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            list-style: none;
        }

        .nav-menu a {
            color: #4a5568;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            font-size: 15px;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            color: #48bb78;
        }

        /* Main Content */
        .main-content {
            padding: 40px 0;
        }

        /* Hero Section - Matching style */
        .hero-section {
            text-align: center;
            margin-bottom: 50px;
        }

        .page-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5em;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 15px;
        }

        .page-subtitle {
            font-size: 1.1em;
            color: #718096;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        /* AI Providers Display */
        .providers-display {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
        }

        .provider-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .provider-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .provider-info {
            text-align: left;
        }

        .provider-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }

        .provider-desc {
            font-size: 11px;
            color: #a0aec0;
        }

        /* API Configuration Section */
        .api-config {
            background: #fef5e7;
            border: 1px solid #f9d71c;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
        }

        .api-config h3 {
            color: #795548;
            font-size: 1.1em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .api-config p {
            font-size: 14px;
            color: #8d6e63;
            margin-bottom: 20px;
        }

        .api-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .api-links {
            font-size: 12px;
            color: #a0aec0;
            margin-top: 15px;
        }

        .api-links a {
            color: #667eea;
            text-decoration: none;
        }

        .api-links a:hover {
            text-decoration: underline;
        }

        /* Main Layout Grid */
        .generation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Card Style matching other pages */
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.2em;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 14px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: white;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #48bb78;
            box-shadow: 0 0 0 3px rgba(72, 187, 120, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Voice Selection Grid */
        .voice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .voice-option {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .voice-option:hover {
            border-color: #cbd5e0;
            background: #f7fafc;
        }

        .voice-option.selected {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .voice-name {
            font-weight: 600;
            font-size: 14px;
            color: #2d3748;
            margin-bottom: 4px;
        }

        .voice-details {
            font-size: 12px;
            color: #a0aec0;
        }

        /* Advanced Settings */
        .advanced-settings {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 15px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #48bb78;
            color: white;
        }

        .btn-primary:hover {
            background: #38a169;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }

        .btn-primary:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-full {
            width: 100%;
        }

        /* Content Display */
        .content-display {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.8;
        }

        .content-display:empty::before {
            content: 'Generated content will appear here...';
            color: #a0aec0;
            font-style: italic;
        }

        /* Progress Section */
        .progress-section {
            display: none;
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .progress-section.active {
            display: block;
        }

        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: #48bb78;
            width: 0%;
            transition: width 0.5s;
            border-radius: 3px;
        }

        .progress-text {
            text-align: center;
            color: #718096;
            font-size: 13px;
        }

        /* Audio Player */
        .audio-player-card {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e2e8f0;
            margin-top: 30px;
        }

        .audio-player-card.active {
            display: block;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .play-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #48bb78;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
        }

        .play-button:hover {
            background: #38a169;
            transform: scale(1.05);
        }

        .audio-progress-container {
            flex: 1;
        }

        .audio-time-display {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }

        .player-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Range Slider Custom Styling */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-track {
            background: #e2e8f0;
            height: 6px;
            border-radius: 3px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            background: #48bb78;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            margin-top: -6px;
        }

        input[type="range"]::-moz-range-track {
            background: #e2e8f0;
            height: 6px;
            border-radius: 3px;
        }

        input[type="range"]::-moz-range-thumb {
            background: #48bb78;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            border: none;
        }

        /* Speed Control */
        .speed-control {
            margin-top: 15px;
        }

        .speed-display {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }

        /* Checkbox Custom */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Toast Messages */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            font-size: 14px;
        }

        .toast.success {
            background: #48bb78;
            color: white;
        }

        .toast.error {
            background: #f56565;
            color: white;
        }

        .toast.info {
            background: #4299e1;
            color: white;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .generation-grid {
                grid-template-columns: 1fr;
            }

            .voice-grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .page-title {
                font-size: 1.8em;
            }

            .providers-display {
                flex-direction: column;
                align-items: center;
            }

            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <a href="https://www.cloudguide.me" target="_blank">
                        <img src="https://s.cloudguide.me/m/files/f9111279-27c8-4c3f-b586-dc705899f1ee.png" alt="CloudGuide">
                    </a>
                    <span class="premium-badge">Premium</span>
                </div>
                <nav>
                    <ul class="nav-menu">
                        <li><a href="index.html">Generator</a></li>
                        <li><a href="library.html">Library</a></li>
                        <li><a href="audio.html">Audio</a></li>
                        <li><a href="premium.html" class="active">Premium</a></li>
                        <li><a href="about.html">About</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="hero-section">
                <h1 class="page-title">Premium AI Audioguide Studio</h1>
                <p class="page-subtitle">
                    Create professional audioguides with Claude AI's advanced content generation 
                    and Speechify's natural-sounding premium voices
                </p>
            </section>



            <!-- API Configuration -->
            <div class="api-config">
                <h3>üîê API Configuration - Secure Local Storage</h3>
                <p><strong>Privacy Notice:</strong> Your API keys are stored ONLY on your device using browser localStorage. They never leave your computer and are not sent to any server. Keys remain encrypted in your browser until you clear your browser data.</p>
                
                <div class="api-input-row">
                    <input type="password" 
                           id="claudeApiKey" 
                           class="form-input" 
                           placeholder="Claude API Key (sk-ant-api...)"
                           style="flex: 1;">
                    <button class="btn btn-primary" onclick="saveApiKeys()">Save Keys Locally</button>
                </div>
                
                <div class="api-input-row">
                    <input type="password" 
                           id="speechifyApiKey" 
                           class="form-input" 
                           placeholder="Speechify API Key (optional for audio)"
                           style="flex: 1;">
                </div>
                
                <div class="api-links">
                    <strong>How it works:</strong> Once you add your API keys here, your browser makes direct calls to Claude/Speechify APIs. No backend server needed - everything runs in your browser for maximum privacy and security.<br><br>
                    Get Claude API key from <a href="https://console.anthropic.com" target="_blank">Anthropic Console</a> | 
                    Get Speechify API from <a href="https://speechify.com/api" target="_blank">Speechify Developer</a>
                </div>
            </div>

            <!-- Generation Grid -->
            <div class="generation-grid">
                <!-- Claude AI Panel -->
                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">ü§ñ</span>
                        Claude AI Content Generation
                    </h2>

                    <div class="form-group">
                        <label class="form-label">Destination / Topic</label>
                        <input type="text" 
                               id="destination" 
                               class="form-input" 
                               placeholder="e.g., Louvre Museum, Ancient Rome, Yosemite National Park...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Guide Type</label>
                        <select id="guideType" class="form-select" onchange="toggleGuideOptions()">
                            <option value="museum">Museum/Indoor Guide</option>
                            <option value="city">City/Outdoor Guide (with GPS & Food)</option>
                            <option value="trail">Nature Trail/Hiking Guide (with GPS)</option>
                        </select>
                    </div>

                    <div class="form-group" id="coordinatesOption" style="display: none;">
                        <label class="form-label">
                            <input type="checkbox" id="includeCoordinates" checked> 
                            Include GPS coordinates for each stop (will not be narrated in audio)
                        </label>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Reference Websites (Optional)</label>
                        <div id="websiteReferences">
                            <div class="website-input-row" style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <input type="url" 
                                       class="form-input website-ref" 
                                       placeholder="https://example.com/article-about-destination"
                                       style="flex: 1;">
                                <button type="button" class="btn btn-secondary" onclick="addWebsiteField()" style="padding: 10px 20px;">+ Add</button>
                            </div>
                        </div>
                        <small style="color: #a0aec0; display: block; margin-top: 8px; font-size: 12px;">
                            Add up to 5 reference websites. Claude will analyze these pages to create more accurate and detailed content.
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Target Audience</label>
                        <select id="audienceType" class="form-select">
                            <option value="general">General Visitors</option>
                            <option value="experts">History Enthusiasts</option>
                            <option value="families">Families with Children</option>
                            <option value="students">Students & Educators</option>
                            <option value="vip">VIP Tours</option>
                            <option value="accessibility">Accessibility Focus</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Content Style</label>
                        <select id="contentStyle" class="form-select">
                            <option value="storytelling">Immersive Storytelling</option>
                            <option value="educational">Educational & Informative</option>
                            <option value="conversational">Casual & Conversational</option>
                            <option value="dramatic">Dramatic & Theatrical</option>
                            <option value="poetic">Poetic & Evocative</option>
                            <option value="humorous">Light & Humorous</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Custom Instructions (Optional)</label>
                        <textarea id="customPrompt" 
                                  class="form-textarea" 
                                  placeholder="Add specific requirements, focus areas, or special instructions..."></textarea>
                    </div>

                    <div class="advanced-settings">
                        <div class="settings-title">‚öôÔ∏è Advanced Settings</div>
                        <div class="settings-grid">
                            <div class="form-group" style="margin: 0;">
                                <label class="form-label">Number of Stops</label>
                                <select id="numStops" class="form-select">
                                    <option value="5">5 Stops</option>
                                    <option value="10" selected>10 Stops</option>
                                    <option value="15">15 Stops</option>
                                    <option value="20">20 Stops</option>
                                    <option value="25">25 Stops</option>
                                    <option value="30">30 Stops (Maximum)</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin: 0;">
                                <label class="form-label">Words per Stop</label>
                                <select id="stopLength" class="form-select">
                                    <option value="500">~500 words</option>
                                    <option value="750" selected>~750 words</option>
                                    <option value="1000">~1000 words</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-full" onclick="generateWithClaude()" style="margin-top: 20px;">
                        Generate with Claude AI
                    </button>

                    <div class="progress-section" id="claudeProgress">
                        <div class="progress-text">Generating content with Claude AI...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="claudeProgressBar"></div>
                        </div>
                        <div class="progress-text" id="claudeStatus">Initializing...</div>
                    </div>

                    <div class="content-display" id="generatedContent"></div>
                </div>

                <!-- Speechify Panel -->
                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üéôÔ∏è</span>
                        Speechify Premium Voices
                    </h2>

                    <div class="form-group">
                        <label class="form-label">Select Premium Voice</label>
                        <div class="voice-grid">
                            <div class="voice-option selected" onclick="selectVoice(this, 'snoop')">
                                <div class="voice-name">Snoop Dogg</div>
                                <div class="voice-details">Celebrity ‚Ä¢ English</div>
                            </div>
                            <div class="voice-option" onclick="selectVoice(this, 'gwyneth')">
                                <div class="voice-name">Gwyneth Paltrow</div>
                                <div class="voice-details">Celebrity ‚Ä¢ English</div>
                            </div>
                            <div class="voice-option" onclick="selectVoice(this, 'david')">
                                <div class="voice-name">David Attenborough</div>
                                <div class="voice-details">Documentary ‚Ä¢ English</div>
                            </div>
                            <div class="voice-option" onclick="selectVoice(this, 'james')">
                                <div class="voice-name">James Earl Jones</div>
                                <div class="voice-details">Narrator ‚Ä¢ Deep</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Voice Language</label>
                        <select id="voiceLanguage" class="form-select">
                            <option value="en-US">English (US)</option>
                            <option value="en-GB">English (UK)</option>
                            <option value="es-ES">Spanish</option>
                            <option value="fr-FR">French</option>
                            <option value="de-DE">German</option>
                            <option value="it-IT">Italian</option>
                            <option value="pt-BR">Portuguese</option>
                            <option value="zh-CN">Chinese</option>
                            <option value="ja-JP">Japanese</option>
                        </select>
                    </div>

                    <div class="form-group speed-control">
                        <label class="form-label">Speech Speed</label>
                        <input type="range" 
                               id="speechSpeed" 
                               class="form-input" 
                               min="0.5" 
                               max="1.5" 
                               value="1.0" 
                               step="0.1">
                        <div class="speed-display">
                            <span>Slow (0.5x)</span>
                            <span id="speedValue">1.0x</span>
                            <span>Fast (1.5x)</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="enhanceAudio" checked>
                            <label for="enhanceAudio" class="form-label" style="margin: 0;">
                                Enable Audio Enhancement & TTS Optimization
                            </label>
                        </div>
                        <div style="background: #fef5e7; border: 1px solid #f9d71c; border-radius: 6px; padding: 12px; margin-top: 10px; font-size: 12px;">
                            <strong>TTS Optimization includes:</strong><br>
                            ‚Ä¢ Roman numerals conversion (XIV ‚Üí fourteenth)<br>
                            ‚Ä¢ Decades formatting (90s ‚Üí nineties)<br>
                            ‚Ä¢ Century formatting (21st ‚Üí twenty-first century)<br>
                            ‚Ä¢ Currency symbols ($100 ‚Üí one hundred dollars)<br>
                            ‚Ä¢ Temperature (20¬∞C ‚Üí twenty degrees Celsius)<br>
                            ‚Ä¢ Eastern European phonetics (≈† ‚Üí sh, ƒå ‚Üí ch)<br>
                            ‚Ä¢ Time format (3:30 PM ‚Üí three thirty P M)
                        </div>
                    </div>

                    <button class="btn btn-primary btn-full" onclick="generateWithSpeechify()" style="margin-top: 20px;">
                        Generate Audio with Speechify
                    </button>

                    <div class="progress-section" id="speechifyProgress">
                        <div class="progress-text">Generating premium audio...</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="speechifyProgressBar"></div>
                        </div>
                        <div class="progress-text" id="speechifyStatus">Processing...</div>
                    </div>
                </div>
            </div>

            <!-- Audio Player -->
            <div class="audio-player-card" id="audioPlayerSection">
                <h2 class="card-title">
                    <span class="card-icon">üéµ</span>
                    Premium Audio Player
                </h2>
                
                <div class="player-controls">
                    <button class="play-button" id="playBtn" onclick="togglePlayback()">‚ñ∂Ô∏è</button>
                    <div class="audio-progress-container">
                        <input type="range" 
                               id="audioProgress" 
                               class="form-input" 
                               min="0" 
                               max="100" 
                               value="0">
                        <div class="audio-time-display">
                            <span id="currentTime">0:00</span>
                            <span id="totalTime">0:00</span>
                        </div>
                    </div>
                </div>

                <div class="player-actions">
                    <button class="btn btn-secondary" onclick="downloadAudio()">üì• Download Audio</button>
                    <button class="btn btn-secondary" onclick="downloadScript()">üìÑ Download Script</button>
                    <button class="btn btn-primary" onclick="saveToLibrary()">üíæ Save to Library</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let selectedVoice = 'snoop';
        let generatedContent = '';
        let audioUrl = null;
        let currentAudio = null;
        let websiteCount = 1;

        // Add website field
        function addWebsiteField() {
            if (websiteCount >= 5) {
                showToast('Maximum 5 reference websites allowed', 'error');
                return;
            }
            
            const container = document.getElementById('websiteReferences');
            const newRow = document.createElement('div');
            newRow.className = 'website-input-row';
            newRow.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
            newRow.innerHTML = `
                <input type="url" 
                       class="form-input website-ref" 
                       placeholder="https://example.com/reference-article"
                       style="flex: 1;">
                <button type="button" class="btn btn-secondary" onclick="removeWebsiteField(this)" style="padding: 10px 20px; background: #f56565;">Remove</button>
            `;
            container.appendChild(newRow);
            websiteCount++;
        }

        // Remove website field
        function removeWebsiteField(button) {
            button.parentElement.remove();
            websiteCount--;
        }

        // Toggle guide options based on type
        function toggleGuideOptions() {
            const guideType = document.getElementById('guideType').value;
            const coordOption = document.getElementById('coordinatesOption');
            
            // Show coordinates option for city and trail guides (outdoor)
            if (guideType === 'city' || guideType === 'trail') {
                coordOption.style.display = 'block';
            } else {
                coordOption.style.display = 'none';
            }
        }

        // Load API keys from localStorage
        window.addEventListener('DOMContentLoaded', function() {
            const savedClaudeKey = localStorage.getItem('claude_api_key');
            const savedSpeechifyKey = localStorage.getItem('speechify_api_key');
            
            if (savedClaudeKey) {
                document.getElementById('claudeApiKey').value = savedClaudeKey;
            }
            if (savedSpeechifyKey) {
                document.getElementById('speechifyApiKey').value = savedSpeechifyKey;
            }

            // Update speed display
            document.getElementById('speechSpeed').addEventListener('input', function() {
                document.getElementById('speedValue').textContent = this.value + 'x';
            });
        });

        // Save API keys
        function saveApiKeys() {
            const claudeKey = document.getElementById('claudeApiKey').value;
            const speechifyKey = document.getElementById('speechifyApiKey').value;
            
            if (claudeKey) {
                localStorage.setItem('claude_api_key', claudeKey);
            }
            if (speechifyKey) {
                localStorage.setItem('speechify_api_key', speechifyKey);
            }
            
            showToast('‚úÖ API keys saved securely to your browser localStorage!', 'success');
        }

        // Select voice
        function selectVoice(element, voice) {
            document.querySelectorAll('.voice-option').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedVoice = voice;
        }

        // Generate content with Claude AI
        async function generateWithClaude() {
            const claudeKey = localStorage.getItem('claude_api_key');
            if (!claudeKey) {
                showToast('Please add your Claude API key first', 'error');
                return;
            }

            const destination = document.getElementById('destination').value;
            if (!destination) {
                showToast('Please enter a destination or topic', 'error');
                return;
            }

            const audience = document.getElementById('audienceType').value;
            const style = document.getElementById('contentStyle').value;
            const customPrompt = document.getElementById('customPrompt').value;
            const numStops = document.getElementById('numStops').value;
            const stopLength = document.getElementById('stopLength').value;

            // Show progress
            document.getElementById('claudeProgress').classList.add('active');
            updateProgress('claude', 10, 'Connecting to Claude AI...');

            try {
                // Create comprehensive prompt
                const prompt = `Create a professional audioguide for ${destination} with ${numStops} stops.

Target Audience: ${audience}
Style: ${style}
Length per stop: approximately ${stopLength} words

${customPrompt ? `Additional Instructions: ${customPrompt}` : ''}

Requirements:
1. Create exactly ${numStops} stops, each focusing on different aspects
2. Each stop should be engaging and immersive
3. Use the ${style} tone throughout
4. Include specific details, stories, and interesting facts
5. Format each stop with a clear title

Please structure the output as:
STOP 1: [Title]
[Content]

STOP 2: [Title]
[Content]

Continue for all ${numStops} stops.`;

                updateProgress('claude', 30, 'Generating content...');

                // Call Claude API (simulated for demo)
                // In production, replace with actual API call
                const response = await simulateClaudeAPI(prompt);
                
                updateProgress('claude', 90, 'Processing response...');

                generatedContent = response;
                document.getElementById('generatedContent').textContent = generatedContent;

                updateProgress('claude', 100, 'Content generated successfully!');
                showToast('Content generated with Claude AI!', 'success');

                setTimeout(() => {
                    document.getElementById('claudeProgress').classList.remove('active');
                }, 2000);

            } catch (error) {
                console.error('Claude API Error:', error);
                showToast('Error: ' + error.message, 'error');
                document.getElementById('claudeProgress').classList.remove('active');
            }
        }

        // Simulate Claude API for demo
        async function simulateClaudeAPI(prompt) {
            await new Promise(resolve => setTimeout(resolve, 2000));
            return `STOP 1: Welcome to ${document.getElementById('destination').value}
Welcome to one of the world's most remarkable destinations. As you stand here, you're about to embark on a journey through history, culture, and extraordinary human achievement...

STOP 2: The Historical Foundation
Let's travel back in time to understand how this place came to be. The story begins centuries ago, when the first foundations were laid...

[Additional stops would be generated by the actual Claude API]`;
        }

        // TTS Text Preprocessing Function (from audio.html)
        function preprocessTextForTTS(text, language = 'en-US') {
            if (!document.getElementById('enhanceAudio').checked) {
                return text;
            }

            let processed = text;

            // Roman Numerals Conversion
            const romanNumerals = {
                'I': '1', 'II': '2', 'III': '3', 'IV': '4', 'V': '5',
                'VI': '6', 'VII': '7', 'VIII': '8', 'IX': '9', 'X': '10',
                'XI': '11', 'XII': '12', 'XIII': '13', 'XIV': '14', 'XV': '15',
                'XVI': '16', 'XVII': '17', 'XVIII': '18', 'XIX': '19', 'XX': '20',
                'XXI': '21'
            };

            // Convert Roman numerals for monarchs and wars
            processed = processed.replace(/\b([IVX]+)\b(?=\s*(century|Century|king|King|queen|Queen|Pope|pope|Emperor|emperor))/g, 
                (match, numeral) => {
                    const number = romanNumerals[numeral];
                    if (number) {
                        const ordinal = getOrdinal(parseInt(number));
                        return ordinal;
                    }
                    return match;
                });

            // World War conversions
            processed = processed.replace(/World War II\b/gi, 'World War Two');
            processed = processed.replace(/World War I\b/gi, 'World War One');
            processed = processed.replace(/WWII\b/gi, 'World War Two');
            processed = processed.replace(/WWI\b/gi, 'World War One');

            // Decades conversion
            processed = processed.replace(/\b(\d{2})s\b/g, (match, decade) => {
                const decadeWords = {
                    '20': 'twenties', '30': 'thirties', '40': 'forties',
                    '50': 'fifties', '60': 'sixties', '70': 'seventies',
                    '80': 'eighties', '90': 'nineties'
                };
                return decadeWords[decade] || match;
            });

            // Century formatting
            processed = processed.replace(/\b(\d{1,2})(st|nd|rd|th)\s+century\b/gi, (match, num) => {
                const ordinal = getOrdinalWord(parseInt(num));
                return `${ordinal} century`;
            });

            // Percentage sign
            processed = processed.replace(/(\d+)%/g, '$1 percent');

            // Currency symbols
            processed = processed.replace(/\$(\d+)/g, '$1 dollars');
            processed = processed.replace(/‚Ç¨(\d+)/g, '$1 euros');
            processed = processed.replace(/¬£(\d+)/g, '$1 pounds');

            // Temperature symbols
            processed = processed.replace(/(\d+)¬∞C\b/g, '$1 degrees Celsius');
            processed = processed.replace(/(\d+)¬∞F\b/g, '$1 degrees Fahrenheit');

            // Eastern European letter replacements
            const letterReplacements = {
                'ƒå': 'Ch', 'ƒç': 'ch', 'ƒÜ': 'Ch', 'ƒá': 'ch',
                '≈†': 'Sh', '≈°': 'sh', '≈Ω': 'Zh', '≈æ': 'zh'
            };

            for (const [original, replacement] of Object.entries(letterReplacements)) {
                processed = processed.replace(new RegExp(original, 'g'), replacement);
            }

            return processed;
        }

        // Helper functions for TTS preprocessing
        function getOrdinal(num) {
            const ordinals = {
                1: 'first', 2: 'second', 3: 'third', 4: 'fourth', 5: 'fifth',
                6: 'sixth', 7: 'seventh', 8: 'eighth', 9: 'ninth', 10: 'tenth',
                11: 'eleventh', 12: 'twelfth', 13: 'thirteenth', 14: 'fourteenth',
                15: 'fifteenth', 16: 'sixteenth', 17: 'seventeenth', 18: 'eighteenth',
                19: 'nineteenth', 20: 'twentieth', 21: 'twenty-first'
            };
            return ordinals[num] || `${num}th`;
        }

        function getOrdinalWord(num) {
            const ordinals = {
                1: 'first', 2: 'second', 3: 'third', 4: 'fourth', 5: 'fifth',
                6: 'sixth', 7: 'seventh', 8: 'eighth', 9: 'ninth', 10: 'tenth',
                11: 'eleventh', 12: 'twelfth', 13: 'thirteenth', 14: 'fourteenth',
                15: 'fifteenth', 16: 'sixteenth', 17: 'seventeenth', 18: 'eighteenth',
                19: 'nineteenth', 20: 'twentieth', 21: 'twenty-first'
            };
            return ordinals[num] || `${num}th`;
        }

        // Function to split text into chunks at word boundaries
        function splitTextIntoChunks(text, maxChunkSize = 3000) {
            const chunks = [];
            const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
            let currentChunk = '';
            
            for (const sentence of sentences) {
                if ((currentChunk + sentence).length > maxChunkSize && currentChunk.length > 0) {
                    chunks.push(currentChunk.trim());
                    currentChunk = sentence;
                } else {
                    currentChunk += sentence;
                }
            }
            
            if (currentChunk.trim()) {
                chunks.push(currentChunk.trim());
            }
            
            return chunks;
        }

        // Function to concatenate audio files using Web Audio API
        async function concatenateAudioUrls(audioUrls) {
            console.log(`Concatenating ${audioUrls.length} audio parts...`);
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const audioBuffers = [];
                
                for (let i = 0; i < audioUrls.length; i++) {
                    console.log(`Loading audio part ${i + 1}/${audioUrls.length}`);
                    updateProgress('speechify', 60 + (30 * i / audioUrls.length), `Combining audio parts... ${i + 1} of ${audioUrls.length}`);
                    
                    const response = await fetch(audioUrls[i]);
                    const arrayBuffer = await response.arrayBuffer();
                    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                    audioBuffers.push(audioBuffer);
                }
                
                // Calculate total length
                const totalLength = audioBuffers.reduce((acc, buffer) => acc + buffer.length, 0);
                const numberOfChannels = audioBuffers[0].numberOfChannels;
                const sampleRate = audioBuffers[0].sampleRate;
                
                // Create output buffer
                const outputBuffer = audioContext.createBuffer(numberOfChannels, totalLength, sampleRate);
                
                // Copy all buffers into the output
                let offset = 0;
                for (const buffer of audioBuffers) {
                    for (let channel = 0; channel < numberOfChannels; channel++) {
                        outputBuffer.copyToChannel(buffer.getChannelData(channel), channel, offset);
                    }
                    offset += buffer.length;
                }
                
                // Convert to WAV format
                const wavBlob = await audioBufferToWav(outputBuffer);
                const url = URL.createObjectURL(wavBlob);
                
                console.log('Audio concatenation complete');
                return url;
                
            } catch (error) {
                console.error('Error concatenating audio:', error);
                throw error;
            }
        }
        
        // Convert AudioBuffer to WAV blob
        function audioBufferToWav(buffer) {
            const numberOfChannels = buffer.numberOfChannels;
            const sampleRate = buffer.sampleRate;
            const format = 1; // PCM
            const bitDepth = 16;
            
            const bytesPerSample = bitDepth / 8;
            const blockAlign = numberOfChannels * bytesPerSample;
            
            const data = [];
            for (let channel = 0; channel < numberOfChannels; channel++) {
                data.push(buffer.getChannelData(channel));
            }
            
            const length = buffer.length;
            const arrayBuffer = new ArrayBuffer(44 + length * numberOfChannels * bytesPerSample);
            const view = new DataView(arrayBuffer);
            
            // WAV header
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + length * numberOfChannels * bytesPerSample, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, format, true);
            view.setUint16(22, numberOfChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * blockAlign, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitDepth, true);
            writeString(36, 'data');
            view.setUint32(40, length * numberOfChannels * bytesPerSample, true);
            
            // Interleave channels and convert to 16-bit PCM
            let offset = 44;
            for (let i = 0; i < length; i++) {
                for (let channel = 0; channel < numberOfChannels; channel++) {
                    const sample = Math.max(-1, Math.min(1, data[channel][i]));
                    view.setInt16(offset, sample * 0x7FFF, true);
                    offset += 2;
                }
            }
            
            return new Blob([arrayBuffer], { type: 'audio/wav' });
        }

        // Generate audio with Speechify (updated with chunking and preprocessing)
        async function generateWithSpeechify() {
            const speechifyKey = localStorage.getItem('speechify_api_key');
            if (!speechifyKey) {
                showToast('Please add your Speechify API key first', 'error');
                return;
            }

            if (!generatedContent) {
                showToast('Please generate content first', 'error');
                return;
            }

            const language = document.getElementById('voiceLanguage').value;
            const speed = parseFloat(document.getElementById('speechSpeed').value);
            const enhance = document.getElementById('enhanceAudio').checked;

            // Apply TTS preprocessing if enabled
            let textToGenerate = generatedContent;
            if (enhance) {
                textToGenerate = preprocessTextForTTS(textToGenerate, language);
                console.log('Text preprocessed for TTS optimization');
            }

            // Check if text needs chunking
            const MAX_TTS_LENGTH = 3000;
            const textChunks = textToGenerate.length > MAX_TTS_LENGTH 
                ? splitTextIntoChunks(textToGenerate, MAX_TTS_LENGTH)
                : [textToGenerate];
            
            console.log(`Text length: ${textToGenerate.length}, Split into ${textChunks.length} chunks`);

            // Show progress
            document.getElementById('speechifyProgress').classList.add('active');
            updateProgress('speechify', 10, 'Preparing audio generation...');

            const audioUrls = [];

            try {
                // Generate audio for each chunk
                for (let i = 0; i < textChunks.length; i++) {
                    const chunk = textChunks[i];
                    console.log(`Generating chunk ${i + 1}/${textChunks.length}, length: ${chunk.length}`);
                    
                    updateProgress('speechify', 20 + (40 * i / textChunks.length), 
                        `Generating audio... Part ${i + 1} of ${textChunks.length}`);

                    // Here you would call the actual Speechify API
                    // For now, this is a placeholder for the API call
                    const audioUrl = await callSpeechifyAPI(chunk, selectedVoice, language, speed);
                    
                    if (audioUrl) {
                        audioUrls.push(audioUrl);
                    } else {
                        throw new Error(`Failed to generate audio for chunk ${i + 1}`);
                    }
                    
                    // Small delay between chunks to avoid rate limiting
                    if (i < textChunks.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                // If we have multiple chunks, concatenate them
                let finalAudioUrl;
                if (audioUrls.length > 1) {
                    console.log('Multiple audio parts generated, concatenating...');
                    updateProgress('speechify', 60, 'Combining audio parts into single file...');
                    
                    try {
                        finalAudioUrl = await concatenateAudioUrls(audioUrls);
                        showToast('‚úÖ Audio parts successfully combined!', 'success');
                    } catch (concatError) {
                        console.error('Failed to concatenate audio files:', concatError);
                        showToast('‚ö†Ô∏è Could not combine audio parts. Using first part only.', 'warning');
                        finalAudioUrl = audioUrls[0];
                    }
                } else {
                    finalAudioUrl = audioUrls[0];
                }

                audioUrl = finalAudioUrl;
                
                updateProgress('speechify', 100, 'Audio generated successfully!');
                showToast('‚úÖ Premium audio generated with Speechify!', 'success');

                // Show audio player
                document.getElementById('audioPlayerSection').classList.add('active');

                setTimeout(() => {
                    document.getElementById('speechifyProgress').classList.remove('active');
                }, 2000);

            } catch (error) {
                console.error('Speechify API Error:', error);
                showToast('Error: ' + error.message, 'error');
                document.getElementById('speechifyProgress').classList.remove('active');
            }
        }

        // Placeholder for actual Speechify API call
        async function callSpeechifyAPI(text, voice, language, speed) {
            // This would be replaced with actual Speechify API implementation
            // For now, simulating API call
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // In production, this would return the actual audio URL from Speechify
            // For demo purposes, returning a data URL placeholder
            return 'data:audio/wav;base64,placeholder';
        }

        // Update progress
        function updateProgress(type, percentage, status) {
            const progressBar = document.getElementById(type + 'ProgressBar');
            const statusText = document.getElementById(type + 'Status');
            
            progressBar.style.width = percentage + '%';
            statusText.textContent = status;
        }

        // Toggle audio playback
        function togglePlayback() {
            const playBtn = document.getElementById('playBtn');
            
            if (!currentAudio) {
                currentAudio = new Audio();
            }
            
            if (currentAudio.paused) {
                playBtn.textContent = '‚è∏Ô∏è';
            } else {
                playBtn.textContent = '‚ñ∂Ô∏è';
            }
        }

        // Download functions
        function downloadAudio() {
            if (!audioUrl) {
                showToast('No audio to download', 'error');
                return;
            }
            showToast('Downloading audio...', 'info');
        }

        function downloadScript() {
            if (!generatedContent) {
                showToast('No script to download', 'error');
                return;
            }
            
            const blob = new Blob([generatedContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'audioguide_script.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Script downloaded!', 'success');
        }

        function saveToLibrary() {
            if (!generatedContent) {
                showToast('No content to save', 'error');
                return;
            }
            
            const audioguides = JSON.parse(localStorage.getItem('cloudguide_audioguides') || '[]');
            const newGuide = {
                id: Date.now(),
                title: document.getElementById('destination').value,
                content: generatedContent,
                type: 'premium',
                createdWith: 'Claude AI + Speechify',
                date: new Date().toISOString()
            };
            
            audioguides.unshift(newGuide);
            localStorage.setItem('cloudguide_audioguides', JSON.stringify(audioguides));
            
            showToast('Saved to library!', 'success');
        }

        // Show toast message
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>