<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="CloudGuide AI Audioguide Generator" />
    <meta property="og:description" content="Generate professional audioguides for museums and cultural heritage sites with AI" />
    <title>CloudGuide - AI Audioguide Generator</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,400i,600,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            color: #4a5568;
            line-height: 1.6;
        }

        .wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .header-inner {
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo img {
            height: 35px;
            transition: opacity 0.3s;
        }

        .logo img:hover {
            opacity: 0.8;
        }

        .nav-links {
            display: flex;
            gap: 25px;
            list-style: none;
        }

        .nav-links a {
            color: #718096;
            text-decoration: none;
            font-weight: 400;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #48bb78;
        }

        /* Hero Section with Background Image */
        .hero-section {
            background: linear-gradient(rgba(45, 55, 72, 0.85), rgba(45, 55, 72, 0.85)), 
                        url('https://s.cloudguide.me/m/files/e966ce00-be17-4370-ae0a-c0d90e3cce18.jpg') center/cover;
            color: white;
            padding: 50px 30px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .hero-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero-subtitle {
            font-size: 0.95em;
            font-weight: 300;
            opacity: 0.9;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Main Container */
        .main-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            padding: 35px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .form-element {
            width: 100%;
            padding: 12px 18px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Nunito Sans', sans-serif;
            transition: all 0.3s;
            background: #f7fafc;
            color: #2d3748;
        }

        .form-element:focus {
            outline: none;
            border-color: #48bb78;
            background: white;
            box-shadow: 0 0 0 3px rgba(72, 187, 120, 0.15);
        }

        select.form-element {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23718096' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 18px;
            padding-right: 45px;
        }

        textarea.form-element {
            min-height: 120px;
            resize: vertical;
        }

        /* Tabs */
        .tabs-container {
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            gap: 12px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 25px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #a0aec0;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }

        .tab-btn:hover {
            color: #48bb78;
        }

        .tab-btn.active {
            color: #48bb78;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #48bb78;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Location Examples */
        .location-examples {
            background: #f7fafc;
            border-radius: 6px;
            padding: 20px;
            margin-top: 12px;
            border: 1px solid #e2e8f0;
        }

        .location-examples h4 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }

        .example-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .example-btn {
            background: white;
            border: 1px solid #48bb78;
            color: #48bb78;
            padding: 6px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .example-btn:hover {
            background: #48bb78;
            color: white;
            transform: translateY(-1px);
        }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 6px;
            padding: 35px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f7fafc;
        }

        .file-upload-area:hover {
            border-color: #48bb78;
            background: white;
        }

        .file-upload-area.dragover {
            border-color: #48bb78;
            background: white;
            transform: scale(1.01);
        }

        .file-icon {
            font-size: 35px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .file-info {
            display: none;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 12px;
        }

        .file-info.active {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Grid Layout */
        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        /* Buttons */
        .generate-btn {
            width: 100%;
            padding: 14px;
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            cursor: pointer;
            margin-top: 25px;
            transition: all 0.3s;
        }

        .generate-btn:hover {
            background: #38a169;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }

        .generate-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .remove-file-btn {
            background: #718096;
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            transition: all 0.3s;
        }

        .remove-file-btn:hover {
            background: #4a5568;
        }

        /* Progress Bar */
        .progress-container {
            display: none;
            margin-top: 20px;
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }

        .progress-container.active {
            display: block;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .progress-title {
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
        }

        .progress-percentage {
            color: #48bb78;
            font-weight: 600;
            font-size: 14px;
        }

        .progress-bar-bg {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-status {
            margin-top: 12px;
            font-size: 13px;
            color: #718096;
            font-style: italic;
        }

        .progress-steps {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #a0aec0;
        }

        .progress-step.active {
            color: #48bb78;
            font-weight: 600;
        }

        .progress-step.completed {
            color: #4a5568;
        }

        .step-icon {
            margin-right: 6px;
        }

        /* Loading State */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #e2e8f0;
            border-top: 3px solid #48bb78;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #718096;
            font-size: 13px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        /* Success Message */
        .success-message {
            display: none;
            background: #48bb78;
            color: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            margin-top: 15px;
            font-weight: 500;
            font-size: 14px;
        }

        .success-message.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Image Section */
        .image-section {
            margin: 30px 0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .image-section img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        /* Footer Section */
        .footer-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e2e8f0;
            text-align: center;
        }

        .funding-text {
            font-size: 12px;
            color: #718096;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .funding-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
        }

        .funding-logo {
            height: 45px;
            opacity: 0.6;
            transition: opacity 0.3s;
            filter: grayscale(20%);
        }

        .funding-logo:hover {
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .funding-logos {
                flex-direction: column;
                gap: 20px;
            }

            .nav-links {
                display: none;
            }

            .hero-title {
                font-size: 2em;
            }

            .main-container {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <!-- Header -->
        <header class="header">
            <div class="header-inner">
                <div class="logo">
                    <a href="https://www.cloudguide.me" target="_blank">
                        <img src="https://s.cloudguide.me/m/files/f9111279-27c8-4c3f-b586-dc705899f1ee.png" alt="CloudGuide logo">
                    </a>
                </div>
                <nav>
                    <ul class="nav-links">
                        <li><a href="index.html" style="color: #48bb78;">GENERATOR</a></li>
                        <li><a href="library.html">LIBRARY</a></li>
                        <li><a href="audio.html">AUDIO</a></li>
                        <li><a href="upload.html">UPLOAD</a></li>
                        <li><a href="premium.html">PREMIUM</a></li>
                        <li><a href="about.html">ABOUT</a></li>
                        <li><a href="https://www.cloudguide.me/contact" target="_blank">CONTACT</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Hero Section with Background Image -->
        <section class="hero-section">
            <h1 class="hero-title">AI Audioguide Generator</h1>
            <p class="hero-subtitle">Create Professional Audioguides for Museums and Cultural Heritage Sites</p>
        </section>

        <!-- Main Content -->
        <div class="main-container">
            <!-- Tabs -->
            <div class="tabs-container">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('location')">Location Input</button>
                    <button class="tab-btn" onclick="switchTab('file')">File Upload</button>
                </div>
            </div>

            <!-- AI Model Selection -->
            <div class="form-group">
                <label for="aiModel">AI Model</label>
                <select id="aiModel" class="form-element">
                    <option value="openai">OpenAI GPT (Best Quality)</option>
                    <option value="groq">Groq Mixtral (Fast & Free)</option>
                    <option value="deepseek">DeepSeek (Budget)</option>
                </select>
                <small style="color: #a0aec0; display: block; margin-top: 8px; font-size: 12px;">
                    üí° Groq is free and fast. OpenAI provides the best quality. DeepSeek is most affordable.
                </small>
            </div>

            <!-- Location Input Tab -->
            <div id="locationTab" class="tab-content active">
                <div class="form-group">
                    <label for="location">Location Name</label>
                    <input type="text" id="location" class="form-element" placeholder="Enter any museum, landmark, city, or cultural site...">
                    <div class="location-examples">
                        <h4>Quick Examples</h4>
                        <div class="example-buttons">
                            <button class="example-btn" onclick="setExample('Louvre Museum Paris')">Louvre Museum</button>
                            <button class="example-btn" onclick="setExample('Sagrada Familia Barcelona')">Sagrada Familia</button>
                            <button class="example-btn" onclick="setExample('Vatican Museums')">Vatican Museums</button>
                            <button class="example-btn" onclick="setExample('Alhambra Granada')">Alhambra Granada</button>
                            <button class="example-btn" onclick="setExample('Acropolis Athens')">Acropolis Athens</button>
                            <button class="example-btn" onclick="setExample('Colosseum Rome')">Colosseum</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Upload Tab -->
            <div id="fileTab" class="tab-content">
                <div class="form-group">
                    <div class="file-upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                        <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt" style="display: none;" onchange="handleFileUpload(event)">
                        <div class="file-icon">üìÑ</div>
                        <p style="font-weight: 600; margin-bottom: 8px; color: #4a5568;">Drop your file here or click to browse</p>
                        <p style="color: #a0aec0; font-size: 13px;">PDF, Word, or TXT files (max 10MB)</p>
                    </div>
                    <div class="file-info" id="fileInfo">
                        <div>
                            <div style="font-weight: 600; color: #2d3748;" id="fileName">No file</div>
                            <div style="color: #718096; font-size: 13px; margin-top: 5px;" id="fileSize">0 KB</div>
                        </div>
                        <button class="remove-file-btn" onclick="removeFile()">Remove</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="fileLocation">Location Name (from document)</label>
                    <input type="text" id="fileLocation" class="form-element" placeholder="Enter the location this document is about...">
                </div>
            </div>

            <!-- Image Section -->
            <div class="image-section">
                <img src="https://s.cloudguide.me/m/files/e966ce00-be17-4370-ae0a-c0d90e3cce18.jpg" alt="Cultural Heritage">
            </div>

            <!-- Configuration Grid -->
            <div class="config-grid">
                <div class="form-group">
                    <label for="language">Output Language</label>
                    <select id="language" class="form-element">
                        <option value="English">English</option>
                        <option value="Spanish">Espa√±ol</option>
                        <option value="French">Fran√ßais</option>
                        <option value="German">Deutsch</option>
                        <option value="Italian">Italiano</option>
                        <option value="Portuguese">Portugu√™s</option>
                        <option value="Chinese">‰∏≠Êñá</option>
                        <option value="Japanese">Êó•Êú¨Ë™û</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="tourType">Tour Type</label>
                    <select id="tourType" class="form-element">
                        <option value="comprehensive">Comprehensive Overview</option>
                        <option value="historical">Historical Focus</option>
                        <option value="cultural">Cultural Heritage</option>
                        <option value="family">Family Friendly</option>
                        <option value="artistic">Art & Architecture</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="stops">Number of Stops</label>
                <select id="stops" class="form-element">
                    <option value="3">Quick Tour (3 stops)</option>
                    <option value="5">Short (5 stops)</option>
                    <option value="8" selected>Standard (8 stops)</option>
                    <option value="10">Extended (10 stops)</option>
                    <option value="12">Comprehensive (12 stops)</option>
                    <option value="15">Detailed (15 stops)</option>
                    <option value="20">In-Depth (20 stops)</option>
                    <option value="25">Maximum (25 stops)</option>
                </select>
                <small style="color: #a0aec0; display: block; margin-top: 10px; font-size: 12px;">
                    Each stop contains ~900 words. More stops = longer, more detailed audioguide.
                </small>
            </div>

            <div class="form-group">
                <label for="context">Additional Context (Optional)</label>
                <textarea id="context" class="form-element" placeholder="Any specific focus, target audience, or special requirements..."></textarea>
            </div>

            <button class="generate-btn" id="generateBtn" onclick="generateGuide()">
                Generate Audioguide
            </button>

            <!-- Progress Bar -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-header">
                    <div class="progress-title">Generating Audioguide</div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progressBar"></div>
                </div>
                <div class="progress-status" id="progressStatus">Initializing...</div>
                <div class="progress-steps" id="progressSteps">
                    <div class="progress-step" data-step="1">
                        <span class="step-icon">‚ö™</span> Introduction
                    </div>
                    <div class="progress-step" data-step="2">
                        <span class="step-icon">‚ö™</span> History
                    </div>
                    <div class="progress-step" data-step="3">
                        <span class="step-icon">‚ö™</span> Attractions
                    </div>
                    <div class="progress-step" data-step="4">
                        <span class="step-icon">‚ö™</span> Cuisine
                    </div>
                    <div class="progress-step" data-step="5">
                        <span class="step-icon">‚ö™</span> Tips
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div class="loading-text">Creating your audioguide</div>
            </div>

            <div class="success-message" id="success">
                ‚úì Audioguide generated successfully and saved to your library!
                <div style="margin-top: 15px;">
                    <a href="library.html" style="color: white; text-decoration: underline;">View in Library</a> | 
                    <a href="audio.html" style="color: white; text-decoration: underline;">Generate Audio</a>
                </div>
            </div>

            <!-- Footer Section -->
            <div class="footer-section">
                <p class="funding-text">
                    Financiado por la Uni√≥n Europea ‚Äì Next Generation EU<br>
                    a trav√©s del Ministerio de Industria y Turismo
                </p>
                <div class="funding-logos">
                    <img src="https://s.cloudguide.me/m/files/d3e690c8-b10a-49e3-8cda-ac3335896b69.png" 
                         alt="EU" class="funding-logo">
                    <img src="https://s.cloudguide.me/m/files/f1eabdef-d522-457d-90fe-fa00b513ac3c.png" 
                         alt="Spain" class="funding-logo">
                </div>
            </div>
        </div>
    </div>

    <script>
        var currentTab = 'location';
        var uploadedFile = null;
        var uploadedFileContent = null;

        // Progress tracking
        var currentProgress = 0;
        var totalSteps = 0;
        var completedSteps = 0;

        function updateProgress(percentage, status, currentStep) {
            document.getElementById('progressContainer').classList.add('active');
            document.getElementById('progressBar').style.width = percentage + '%';
            document.getElementById('progressPercentage').textContent = Math.round(percentage) + '%';
            document.getElementById('progressStatus').textContent = status;
            
            // Update step indicators
            if (currentStep) {
                var steps = document.querySelectorAll('.progress-step');
                steps.forEach(function(step, index) {
                    if (index < currentStep - 1) {
                        step.classList.add('completed');
                        step.querySelector('.step-icon').textContent = '‚úÖ';
                    } else if (index === currentStep - 1) {
                        step.classList.add('active');
                        step.querySelector('.step-icon').textContent = '‚è≥';
                    }
                });
            }
        }

        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            var tabButtons = document.querySelectorAll('.tab-btn');
            for (var i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            event.target.classList.add('active');
            
            // Update tab content
            if (tab === 'location') {
                document.getElementById('locationTab').classList.add('active');
                document.getElementById('fileTab').classList.remove('active');
            } else {
                document.getElementById('locationTab').classList.remove('active');
                document.getElementById('fileTab').classList.add('active');
            }
        }

        function setExample(location) {
            document.getElementById('location').value = location;
        }

        function handleFileUpload(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 10 * 1024 * 1024) {
                alert('File size must be less than 10MB');
                event.target.value = '';
                return;
            }
            
            uploadedFile = file;
            
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileInfo').classList.add('active');
            
            // Read file content based on type
            if (file.type === 'application/pdf') {
                readPDFFile(file);
            } else {
                var reader = new FileReader();
                reader.onload = function(e) {
                    uploadedFileContent = e.target.result;
                    suggestLocationFromContent(e.target.result);
                };
                reader.readAsText(file);
            }
        }

        function readPDFFile(file) {
            // For PDF files, we'll need to use a PDF reading library
            // For now, we'll just store the file
            uploadedFileContent = '[PDF File - Content extraction requires PDF.js library]';
            console.log('PDF file uploaded. In production, use PDF.js to extract text.');
        }

        function removeFile() {
            uploadedFile = null;
            uploadedFileContent = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').classList.remove('active');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            var k = 1024;
            var sizes = ['Bytes', 'KB', 'MB'];
            var i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function suggestLocationFromContent(content) {
            var lines = content.split('\n');
            if (lines[0] && lines[0].length < 100) {
                document.getElementById('fileLocation').value = lines[0].trim();
            }
        }

        // Drag and drop support
        window.addEventListener('DOMContentLoaded', function() {
            var uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                var files = e.dataTransfer.files;
                if (files.length > 0) {
                    document.getElementById('fileInput').files = files;
                    handleFileUpload({ target: { files: files } });
                }
            });
        });

        async function generateGuide() {
            var aiModel = document.getElementById('aiModel').value;
            var language = document.getElementById('language').value;
            var tourType = document.getElementById('tourType').value;
            var stops = parseInt(document.getElementById('stops').value);
            var context = document.getElementById('context').value.trim();
            var location = '';
            var useFile = false;

            if (currentTab === 'location') {
                location = document.getElementById('location').value.trim();
                if (!location) {
                    alert('Please enter a location');
                    return;
                }
            } else {
                location = document.getElementById('fileLocation').value.trim();
                if (!location) {
                    alert('Please enter the location name from your document');
                    return;
                }
                if (!uploadedFile || !uploadedFileContent) {
                    alert('Please upload a document first');
                    return;
                }
                useFile = true;
                context = 'Document content: ' + uploadedFileContent.substring(0, 3000) + '\n\n' + context;
            }

            // Show loading
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('loading').classList.add('active');
            document.getElementById('success').classList.remove('active');

            try {
                var audioguideContent;

                if (aiModel === 'groq') {
                    // Use the new Groq API integration
                    audioguideContent = await generateWithGroq(location, language, tourType, stops, context);
                } else {
                    // Use the existing method for other AI models
                    audioguideContent = await generateAudioguideContent(location, language, tourType, stops, context, aiModel, useFile);
                }
                
                // CRITICAL: Save to localStorage for Library
                const savedGuide = saveToLibrary(location, language, tourType, stops, audioguideContent);
                console.log('‚úÖ Audioguide saved to library with ID:', savedGuide.id);
                
                // Also save the last generated guide ID for easy reference
                localStorage.setItem('lastGeneratedGuideId', savedGuide.id.toString());
                
                // Download the file
                downloadAudioguide(audioguideContent, location);
                
                document.getElementById('success').classList.add('active');
                
                // Update success message with direct link to audio generation
                document.getElementById('success').innerHTML = `
                    ‚úì Audioguide generated successfully and saved to your library!
                    <div style="margin-top: 15px;">
                        <a href="library.html" style="color: white; text-decoration: underline;">View in Library</a> | 
                        <a href="audio.html?id=${savedGuide.id}" style="color: white; text-decoration: underline;">Generate Audio</a>
                    </div>
                `;
                
                setTimeout(function() {
                    document.getElementById('success').classList.remove('active');
                }, 10000);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to generate audioguide: ' + error.message);
            } finally {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('loading').classList.remove('active');
                
                // Hide progress bar after 2 seconds
                setTimeout(function() {
                    document.getElementById('progressContainer').classList.remove('active');
                    // Reset progress
                    document.getElementById('progressBar').style.width = '0%';
                    document.querySelectorAll('.progress-step').forEach(function(step) {
                        step.classList.remove('active', 'completed');
                        step.querySelector('.step-icon').textContent = '‚ö™';
                    });
                }, 2000);
            }
        }

        // Enhanced Groq API integration function
        async function generateWithGroq(destination, language, tourType, stops, context) {
            updateProgress(5, 'Connecting to Groq AI...', 1);
            
            try {
                console.log('Sending request to Groq with:', {
                    destination: destination,
                    stops: stops,
                    tourType: tourType,
                    language: language
                });

                var response = await fetch('/api/groq', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        destination: destination,
                        stops: stops,
                        tourType: tourType,
                        language: language
                    })
                });

                console.log('Groq response status:', response.status);

                // Get the raw response text first
                var responseText = await response.text();
                console.log('Raw response preview:', responseText.substring(0, 200) + '...');

                if (!response.ok) {
                    // Try to parse error JSON for better error messages
                    try {
                        var errorData = JSON.parse(responseText);
                        var errorMessage = 'Groq API Error: ';
                        
                        if (errorData.error === 'Groq API key not configured in environment variables') {
                            errorMessage += 'API key not set. Please configure GROQ_API_KEY in Vercel settings.';
                        } else if (errorData.error === 'All Groq models failed') {
                            errorMessage += 'All Groq models are currently unavailable. Try using OpenAI or DeepSeek instead.';
                        } else {
                            errorMessage += errorData.error || errorData.message || 'Unknown error';
                        }
                        
                        if (errorData.suggestion) {
                            errorMessage += ' Suggestion: ' + errorData.suggestion;
                        }
                        
                        throw new Error(errorMessage);
                    } catch (parseError) {
                        // If it's HTML error page
                        if (responseText.includes('<html') || responseText.includes('<!DOCTYPE')) {
                            throw new Error(`Server error (${response.status}). Check your Groq API key in Vercel environment variables.`);
                        }
                        throw new Error(`Groq API error (${response.status}): ${responseText.substring(0, 150)}`);
                    }
                }

                updateProgress(80, 'Processing Groq response...', 4);
                
                // Try to parse the successful response
                var data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Failed to parse response as JSON:', parseError);
                    throw new Error('Invalid response format from Groq server');
                }
                
                console.log('Groq success! Model used:', data.modelUsed || 'unknown');
                
                updateProgress(100, 'Audioguide completed!', 5);
                
                // Return the formatted content from Groq
                return data.content || data.message || 'Error: No content generated';
                
            } catch (error) {
                console.error('Groq API Error:', error);
                // Provide helpful error message based on error type
                var userFriendlyError = error.message;
                
                if (error.message.includes('API key')) {
                    userFriendlyError = 'Groq API key not configured. Please set GROQ_API_KEY in your Vercel environment variables.';
                } else if (error.message.includes('models failed')) {
                    userFriendlyError = 'Groq models are currently unavailable. Try selecting OpenAI or DeepSeek instead.';
                } else if (error.message.includes('500')) {
                    userFriendlyError = 'Groq server error. Please try again in a few minutes or use OpenAI/DeepSeek.';
                }
                
                throw new Error(userFriendlyError);
            }
        }

        function saveToLibrary(location, language, tourType, stops, content) {
            // Get existing audioguides
            var audioguides = [];
            var stored = localStorage.getItem('cloudguide_audioguides');
            if (stored) {
                try {
                    audioguides = JSON.parse(stored);
                } catch (e) {
                    console.error('Error parsing stored audioguides:', e);
                    audioguides = [];
                }
            }
            
            // Create new guide with guaranteed unique ID
            var newGuide = {
                id: Date.now() + Math.random(), // Ensure uniqueness
                title: location,
                location: location,
                language: language,
                tourType: tourType,
                stops: stops,
                date: new Date().toISOString(),
                content: content,
                type: 'generated',
                wordCount: content ? content.split(/\s+/).length : 0
            };
            
            // Add to beginning of array
            audioguides.unshift(newGuide);
            
            // Keep only last 50 audioguides
            if (audioguides.length > 50) {
                audioguides = audioguides.slice(0, 50);
            }
            
            // Save back to localStorage
            try {
                localStorage.setItem('cloudguide_audioguides', JSON.stringify(audioguides));
                console.log('‚úÖ Successfully saved audioguide to library:', newGuide);
                
                // Verify it was saved
                var verification = localStorage.getItem('cloudguide_audioguides');
                if (verification) {
                    var verifyParsed = JSON.parse(verification);
                    var foundGuide = verifyParsed.find(g => g.id === newGuide.id);
                    if (foundGuide) {
                        console.log('‚úÖ Verification successful - guide is in localStorage');
                    } else {
                        console.error('‚ùå Verification failed - guide not found after saving');
                    }
                }
            } catch (e) {
                console.error('Error saving to localStorage:', e);
                if (e.name === 'QuotaExceededError') {
                    // Clear old guides if storage is full
                    audioguides = audioguides.slice(0, 10);
                    localStorage.setItem('cloudguide_audioguides', JSON.stringify(audioguides));
                    console.log('Storage was full - kept only 10 most recent guides');
                }
            }
            
            return newGuide;
        }

        async function generateAudioguideContent(location, language, tourType, totalStops, context, aiModel, useFile) {
            var content = 'AUDIOGUIDE: ' + location.toUpperCase() + '\n';
            content += '=' + '='.repeat(50) + '\n\n';
            content += 'Language: ' + language + '\n';
            content += 'Tour Type: ' + tourType + '\n';
            content += 'Total Stops: ' + totalStops + '\n';
            
            // Update AI Model name display
            var modelName = aiModel === 'openai' ? 'OpenAI GPT' : 
                            aiModel === 'groq' ? 'Groq Mixtral' : 'DeepSeek';
            content += 'AI Model: ' + modelName + '\n';
            content += 'Source: ' + (useFile ? 'Uploaded Document' : 'Direct Input') + '\n\n';
            content += '=' + '='.repeat(50) + '\n\n';

            // For demo purposes, generate sample content
            // In production, this would call your AI API endpoints
            
            updateProgress(20, 'Creating introduction...', 1);
            content += 'STOP 1: INTRODUCTION\n';
            content += '-'.repeat(30) + '\n\n';
            content += generateSampleContent(location, 'introduction', language);
            content += '\n\n';

            updateProgress(40, 'Researching history...', 2);
            content += 'STOP 2: HISTORY\n';
            content += '-'.repeat(30) + '\n\n';
            content += generateSampleContent(location, 'history', language);
            content += '\n\n';

            updateProgress(60, 'Adding attractions...', 3);
            for (var i = 3; i <= totalStops - 2; i++) {
                content += 'STOP ' + i + ': ATTRACTION ' + (i - 2) + '\n';
                content += '-'.repeat(30) + '\n\n';
                content += generateSampleContent(location, 'attraction', language);
                content += '\n\n';
            }

            updateProgress(80, 'Local cuisine section...', 4);
            content += 'STOP ' + (totalStops - 1) + ': LOCAL CUISINE\n';
            content += '-'.repeat(30) + '\n\n';
            content += generateSampleContent(location, 'cuisine', language);
            content += '\n\n';

            updateProgress(95, 'Adding practical tips...', 5);
            content += 'STOP ' + totalStops + ': PRACTICAL TIPS\n';
            content += '-'.repeat(30) + '\n\n';
            content += generateSampleContent(location, 'tips', language);
            content += '\n\n';

            content += '=' + '='.repeat(50) + '\n';
            content += '¬© CloudGuide - www.cloudguide.me\n';
            
            updateProgress(100, 'Audioguide completed!', 5);
            
            return content;
        }

        function generateSampleContent(location, type, language) {
            // This is sample content for demonstration
            // In production, this would be replaced with actual AI-generated content
            
            const samples = {
                introduction: `Welcome to ${location}. This remarkable destination offers visitors an unforgettable journey through history, culture, and human achievement. As you explore today, you will discover the many layers of significance that make this place truly special. The architecture, the stories, and the atmosphere all combine to create an experience that will stay with you long after your visit.`,
                
                history: `The history of ${location} spans centuries of human civilization. From its earliest foundations to the present day, this site has witnessed the rise and fall of empires, the creation of masterpieces, and the preservation of cultural heritage. Each stone, each artifact, tells a story of human ambition, creativity, and resilience.`,
                
                attraction: `This particular section of ${location} represents one of the most significant aspects of the site. Notice the intricate details that have been preserved through the centuries. The craftsmanship on display here demonstrates the skill and dedication of the artisans who created these works. Take a moment to appreciate both the grand design and the subtle elements that might otherwise go unnoticed.`,
                
                cuisine: `The culinary traditions of ${location} reflect centuries of cultural exchange and local innovation. Visitors should not miss the opportunity to sample authentic local dishes that have been perfected over generations. From traditional recipes passed down through families to modern interpretations of classic flavors, the food here tells its own story of the region.`,
                
                tips: `To make the most of your visit to ${location}, consider arriving early to avoid crowds. Purchase tickets in advance when possible, and allow sufficient time to explore thoroughly. Comfortable walking shoes are essential, as you'll be covering considerable ground. Don't forget to bring water and sun protection during warmer months.`
            };
            
            return samples[type] || samples.attraction;
        }

        function downloadAudioguide(content, location) {
            var blob = new Blob([content], { type: 'text/plain' });
            var url = window.URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'CloudGuide_' + location.replace(/[^a-z0-9]/gi, '_') + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
